#include <stdio.h>
#include <stdlib.h>

typedef struct Alloc{ void* p; struct Alloc* next;} Alloc;
Alloc* head=NULL;

void* track_malloc(size_t s){
    void* p=malloc(s);
    Alloc* a=malloc(sizeof(Alloc));
    a->p=p; a->next=head; head=a;
    return p;
}

void track_free(void* p){
    Alloc **cur=&head;
    while(*cur){
        if((*cur)->p==p){ Alloc* tmp=*cur; *cur=(*cur)->next; free(tmp); free(p); return; }
        cur=&((*cur)->next);
    }
    free(p);
}

int main(){
    int *a=(int*)track_malloc(sizeof(int)*10);
    int *b=(int*)track_malloc(sizeof(int)*20);
    track_free(a);
    // forget to free b -> leak
    Alloc* t=head; int cnt=0;
    while(t){ cnt++; t=t->next; }
    printf("Potential leaks: %d\n", cnt);
    // cleanup
    while(head){ Alloc* tmp=head; head=head->next; free(tmp->p); free(tmp); }
    return 0;
}
